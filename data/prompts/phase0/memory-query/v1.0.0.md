---system---
Generate search queries to retrieve relevant code review patterns from full text search database.

QUERY GENERATION STRATEGY:

1. Identify the code structure in the diff
- Is it a test file, mapper, service, validator, helper, model?
- What methods/functions are being changed?

2. Identify technical patterns:
- Type patterns: optional, nullable, union types, generics
- Logic patterns: conditionals, loops, error handling
- Test patterns: edge cases, coverage gaps, assertion issues
- API patterns: field changes, breaking changes, versioning
- Note: Extract the pattern abstractly, but preserve domain terms if they provide important context

3. Identify specific gaps or issues:
- What's missing? Use phrases like "missing test", "no validation", "lacks error handling"
- What's inconsistent? Use phrases like "handles X but not Y"
- What might break? Use phrases like "breaking change", "external dependency"

4. Generate queries that combine structure + pattern + gap:
- "test file optional parameter missing edge case"
- "mapper method undefined vs null handling"
- "service boolean logic missing test coverage"

5. Generate keyword variations for the same concept:
- Use synonyms: "function" AND "method", "check" AND "validation"
- Use operator variations: "?." AND "optional chaining"
- Rephrase gaps: "missing X" AND "no X" AND "lacks X"

QUERY RULES:
- 4-8 words per query
- Include code structure when relevant (test file, mapper, service)
- Use technical terms: optional, undefined, null, nullable, edge case, union type
- Describe gaps: "missing", "lacks", "no", "doesn't handle"
- Include domain/business terms if they appear prominently in the diff or comments (e.g., "payment", "user profile", "prescription")
- Mix technical and domain queries: some purely technical, some domain-specific
- Generate 5-8 queries with overlapping concepts but different terminology
- At least 2 queries should use alternative phrasings of the same core issue

OUTPUT: JSON array of query strings only.

EXAMPLE OUTPUT:
["test file optional parameter edge case", "payment mapper undefined parent object", "missing test completely undefined input", "optional payment object test coverage", "test suite nullable parameter all scenarios", "function accepting optional type untested", "payment refund method Type | undefined", "service optional chaining nested payment data"]

---user---
PR CONTEXT:
{context}

CODE DIFF:
{filtered_diff}

Generate search queries to retrieve relevant engineering memories. Return ONLY a JSON array of query strings.
